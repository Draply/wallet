{"ast":null,"code":"import { TAG_ID as $, NS, isNumberedHeader } from '../common/html.js'; //Element utils\n\nconst IMPLICIT_END_TAG_REQUIRED = new Set([$.DD, $.DT, $.LI, $.OPTGROUP, $.OPTION, $.P, $.RB, $.RP, $.RT, $.RTC]);\nconst IMPLICIT_END_TAG_REQUIRED_THOROUGHLY = new Set([...IMPLICIT_END_TAG_REQUIRED, $.CAPTION, $.COLGROUP, $.TBODY, $.TD, $.TFOOT, $.TH, $.THEAD, $.TR]);\nconst SCOPING_ELEMENT_NS = new Map([[$.APPLET, NS.HTML], [$.CAPTION, NS.HTML], [$.HTML, NS.HTML], [$.MARQUEE, NS.HTML], [$.OBJECT, NS.HTML], [$.TABLE, NS.HTML], [$.TD, NS.HTML], [$.TEMPLATE, NS.HTML], [$.TH, NS.HTML], [$.ANNOTATION_XML, NS.MATHML], [$.MI, NS.MATHML], [$.MN, NS.MATHML], [$.MO, NS.MATHML], [$.MS, NS.MATHML], [$.MTEXT, NS.MATHML], [$.DESC, NS.SVG], [$.FOREIGN_OBJECT, NS.SVG], [$.TITLE, NS.SVG]]);\nconst NAMED_HEADERS = [$.H1, $.H2, $.H3, $.H4, $.H5, $.H6];\nconst TABLE_ROW_CONTEXT = [$.TR, $.TEMPLATE, $.HTML];\nconst TABLE_BODY_CONTEXT = [$.TBODY, $.TFOOT, $.THEAD, $.TEMPLATE, $.HTML];\nconst TABLE_CONTEXT = [$.TABLE, $.TEMPLATE, $.HTML];\nconst TABLE_CELLS = [$.TD, $.TH]; //Stack of open elements\n\nexport class OpenElementStack {\n  get currentTmplContentOrNode() {\n    return this._isInTemplate() ? this.treeAdapter.getTemplateContent(this.current) : this.current;\n  }\n\n  constructor(document, treeAdapter, handler) {\n    this.treeAdapter = treeAdapter;\n    this.handler = handler;\n    this.items = [];\n    this.tagIDs = [];\n    this.stackTop = -1;\n    this.tmplCount = 0;\n    this.currentTagId = $.UNKNOWN;\n    this.current = document;\n  } //Index of element\n\n\n  _indexOf(element) {\n    return this.items.lastIndexOf(element, this.stackTop);\n  } //Update current element\n\n\n  _isInTemplate() {\n    return this.currentTagId === $.TEMPLATE && this.treeAdapter.getNamespaceURI(this.current) === NS.HTML;\n  }\n\n  _updateCurrentElement() {\n    this.current = this.items[this.stackTop];\n    this.currentTagId = this.tagIDs[this.stackTop];\n  } //Mutations\n\n\n  push(element, tagID) {\n    this.stackTop++;\n    this.items[this.stackTop] = element;\n    this.current = element;\n    this.tagIDs[this.stackTop] = tagID;\n    this.currentTagId = tagID;\n\n    if (this._isInTemplate()) {\n      this.tmplCount++;\n    }\n\n    this.handler.onItemPush(element, tagID, true);\n  }\n\n  pop() {\n    const popped = this.current;\n\n    if (this.tmplCount > 0 && this._isInTemplate()) {\n      this.tmplCount--;\n    }\n\n    this.stackTop--;\n\n    this._updateCurrentElement();\n\n    this.handler.onItemPop(popped, true);\n  }\n\n  replace(oldElement, newElement) {\n    const idx = this._indexOf(oldElement);\n\n    this.items[idx] = newElement;\n\n    if (idx === this.stackTop) {\n      this.current = newElement;\n    }\n  }\n\n  insertAfter(referenceElement, newElement, newElementID) {\n    const insertionIdx = this._indexOf(referenceElement) + 1;\n    this.items.splice(insertionIdx, 0, newElement);\n    this.tagIDs.splice(insertionIdx, 0, newElementID);\n    this.stackTop++;\n\n    if (insertionIdx === this.stackTop) {\n      this._updateCurrentElement();\n    }\n\n    this.handler.onItemPush(this.current, this.currentTagId, insertionIdx === this.stackTop);\n  }\n\n  popUntilTagNamePopped(tagName) {\n    let targetIdx = this.stackTop + 1;\n\n    do {\n      targetIdx = this.tagIDs.lastIndexOf(tagName, targetIdx - 1);\n    } while (targetIdx > 0 && this.treeAdapter.getNamespaceURI(this.items[targetIdx]) !== NS.HTML);\n\n    this.shortenToLength(targetIdx < 0 ? 0 : targetIdx);\n  }\n\n  shortenToLength(idx) {\n    while (this.stackTop >= idx) {\n      const popped = this.current;\n\n      if (this.tmplCount > 0 && this._isInTemplate()) {\n        this.tmplCount -= 1;\n      }\n\n      this.stackTop--;\n\n      this._updateCurrentElement();\n\n      this.handler.onItemPop(popped, this.stackTop < idx);\n    }\n  }\n\n  popUntilElementPopped(element) {\n    const idx = this._indexOf(element);\n\n    this.shortenToLength(idx < 0 ? 0 : idx);\n  }\n\n  popUntilPopped(tagNames, targetNS) {\n    const idx = this._indexOfTagNames(tagNames, targetNS);\n\n    this.shortenToLength(idx < 0 ? 0 : idx);\n  }\n\n  popUntilNumberedHeaderPopped() {\n    this.popUntilPopped(NAMED_HEADERS, NS.HTML);\n  }\n\n  popUntilTableCellPopped() {\n    this.popUntilPopped(TABLE_CELLS, NS.HTML);\n  }\n\n  popAllUpToHtmlElement() {\n    //NOTE: here we assume that the root <html> element is always first in the open element stack, so\n    //we perform this fast stack clean up.\n    this.tmplCount = 0;\n    this.shortenToLength(1);\n  }\n\n  _indexOfTagNames(tagNames, namespace) {\n    for (let i = this.stackTop; i >= 0; i--) {\n      if (tagNames.includes(this.tagIDs[i]) && this.treeAdapter.getNamespaceURI(this.items[i]) === namespace) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  clearBackTo(tagNames, targetNS) {\n    const idx = this._indexOfTagNames(tagNames, targetNS);\n\n    this.shortenToLength(idx + 1);\n  }\n\n  clearBackToTableContext() {\n    this.clearBackTo(TABLE_CONTEXT, NS.HTML);\n  }\n\n  clearBackToTableBodyContext() {\n    this.clearBackTo(TABLE_BODY_CONTEXT, NS.HTML);\n  }\n\n  clearBackToTableRowContext() {\n    this.clearBackTo(TABLE_ROW_CONTEXT, NS.HTML);\n  }\n\n  remove(element) {\n    const idx = this._indexOf(element);\n\n    if (idx >= 0) {\n      if (idx === this.stackTop) {\n        this.pop();\n      } else {\n        this.items.splice(idx, 1);\n        this.tagIDs.splice(idx, 1);\n        this.stackTop--;\n\n        this._updateCurrentElement();\n\n        this.handler.onItemPop(element, false);\n      }\n    }\n  } //Search\n\n\n  tryPeekProperlyNestedBodyElement() {\n    //Properly nested <body> element (should be second element in stack).\n    return this.stackTop >= 1 && this.tagIDs[1] === $.BODY ? this.items[1] : null;\n  }\n\n  contains(element) {\n    return this._indexOf(element) > -1;\n  }\n\n  getCommonAncestor(element) {\n    const elementIdx = this._indexOf(element) - 1;\n    return elementIdx >= 0 ? this.items[elementIdx] : null;\n  }\n\n  isRootHtmlElementCurrent() {\n    return this.stackTop === 0 && this.tagIDs[0] === $.HTML;\n  } //Element in scope\n\n\n  hasInScope(tagName) {\n    for (let i = this.stackTop; i >= 0; i--) {\n      const tn = this.tagIDs[i];\n      const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n      if (tn === tagName && ns === NS.HTML) {\n        return true;\n      }\n\n      if (SCOPING_ELEMENT_NS.get(tn) === ns) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  hasNumberedHeaderInScope() {\n    for (let i = this.stackTop; i >= 0; i--) {\n      const tn = this.tagIDs[i];\n      const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n      if (isNumberedHeader(tn) && ns === NS.HTML) {\n        return true;\n      }\n\n      if (SCOPING_ELEMENT_NS.get(tn) === ns) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  hasInListItemScope(tagName) {\n    for (let i = this.stackTop; i >= 0; i--) {\n      const tn = this.tagIDs[i];\n      const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n      if (tn === tagName && ns === NS.HTML) {\n        return true;\n      }\n\n      if ((tn === $.UL || tn === $.OL) && ns === NS.HTML || SCOPING_ELEMENT_NS.get(tn) === ns) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  hasInButtonScope(tagName) {\n    for (let i = this.stackTop; i >= 0; i--) {\n      const tn = this.tagIDs[i];\n      const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n      if (tn === tagName && ns === NS.HTML) {\n        return true;\n      }\n\n      if (tn === $.BUTTON && ns === NS.HTML || SCOPING_ELEMENT_NS.get(tn) === ns) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  hasInTableScope(tagName) {\n    for (let i = this.stackTop; i >= 0; i--) {\n      const tn = this.tagIDs[i];\n      const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n      if (ns !== NS.HTML) {\n        continue;\n      }\n\n      if (tn === tagName) {\n        return true;\n      }\n\n      if (tn === $.TABLE || tn === $.TEMPLATE || tn === $.HTML) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  hasTableBodyContextInTableScope() {\n    for (let i = this.stackTop; i >= 0; i--) {\n      const tn = this.tagIDs[i];\n      const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n      if (ns !== NS.HTML) {\n        continue;\n      }\n\n      if (tn === $.TBODY || tn === $.THEAD || tn === $.TFOOT) {\n        return true;\n      }\n\n      if (tn === $.TABLE || tn === $.HTML) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  hasInSelectScope(tagName) {\n    for (let i = this.stackTop; i >= 0; i--) {\n      const tn = this.tagIDs[i];\n      const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n      if (ns !== NS.HTML) {\n        continue;\n      }\n\n      if (tn === tagName) {\n        return true;\n      }\n\n      if (tn !== $.OPTION && tn !== $.OPTGROUP) {\n        return false;\n      }\n    }\n\n    return true;\n  } //Implied end tags\n\n\n  generateImpliedEndTags() {\n    while (IMPLICIT_END_TAG_REQUIRED.has(this.currentTagId)) {\n      this.pop();\n    }\n  }\n\n  generateImpliedEndTagsThoroughly() {\n    while (IMPLICIT_END_TAG_REQUIRED_THOROUGHLY.has(this.currentTagId)) {\n      this.pop();\n    }\n  }\n\n  generateImpliedEndTagsWithExclusion(exclusionId) {\n    while (this.currentTagId !== exclusionId && IMPLICIT_END_TAG_REQUIRED_THOROUGHLY.has(this.currentTagId)) {\n      this.pop();\n    }\n  }\n\n}","map":{"version":3,"sources":["U:/NFT-Mar/faucet/node_modules/cheerio/node_modules/parse5/dist/parser/open-element-stack.js"],"names":["TAG_ID","$","NS","isNumberedHeader","IMPLICIT_END_TAG_REQUIRED","Set","DD","DT","LI","OPTGROUP","OPTION","P","RB","RP","RT","RTC","IMPLICIT_END_TAG_REQUIRED_THOROUGHLY","CAPTION","COLGROUP","TBODY","TD","TFOOT","TH","THEAD","TR","SCOPING_ELEMENT_NS","Map","APPLET","HTML","MARQUEE","OBJECT","TABLE","TEMPLATE","ANNOTATION_XML","MATHML","MI","MN","MO","MS","MTEXT","DESC","SVG","FOREIGN_OBJECT","TITLE","NAMED_HEADERS","H1","H2","H3","H4","H5","H6","TABLE_ROW_CONTEXT","TABLE_BODY_CONTEXT","TABLE_CONTEXT","TABLE_CELLS","OpenElementStack","currentTmplContentOrNode","_isInTemplate","treeAdapter","getTemplateContent","current","constructor","document","handler","items","tagIDs","stackTop","tmplCount","currentTagId","UNKNOWN","_indexOf","element","lastIndexOf","getNamespaceURI","_updateCurrentElement","push","tagID","onItemPush","pop","popped","onItemPop","replace","oldElement","newElement","idx","insertAfter","referenceElement","newElementID","insertionIdx","splice","popUntilTagNamePopped","tagName","targetIdx","shortenToLength","popUntilElementPopped","popUntilPopped","tagNames","targetNS","_indexOfTagNames","popUntilNumberedHeaderPopped","popUntilTableCellPopped","popAllUpToHtmlElement","namespace","i","includes","clearBackTo","clearBackToTableContext","clearBackToTableBodyContext","clearBackToTableRowContext","remove","tryPeekProperlyNestedBodyElement","BODY","contains","getCommonAncestor","elementIdx","isRootHtmlElementCurrent","hasInScope","tn","ns","get","hasNumberedHeaderInScope","hasInListItemScope","UL","OL","hasInButtonScope","BUTTON","hasInTableScope","hasTableBodyContextInTableScope","hasInSelectScope","generateImpliedEndTags","has","generateImpliedEndTagsThoroughly","generateImpliedEndTagsWithExclusion","exclusionId"],"mappings":"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","sourcesContent":["import { TAG_ID as $, NS, isNumberedHeader } from '../common/html.js';\n//Element utils\nconst IMPLICIT_END_TAG_REQUIRED = new Set([$.DD, $.DT, $.LI, $.OPTGROUP, $.OPTION, $.P, $.RB, $.RP, $.RT, $.RTC]);\nconst IMPLICIT_END_TAG_REQUIRED_THOROUGHLY = new Set([\n    ...IMPLICIT_END_TAG_REQUIRED,\n    $.CAPTION,\n    $.COLGROUP,\n    $.TBODY,\n    $.TD,\n    $.TFOOT,\n    $.TH,\n    $.THEAD,\n    $.TR,\n]);\nconst SCOPING_ELEMENT_NS = new Map([\n    [$.APPLET, NS.HTML],\n    [$.CAPTION, NS.HTML],\n    [$.HTML, NS.HTML],\n    [$.MARQUEE, NS.HTML],\n    [$.OBJECT, NS.HTML],\n    [$.TABLE, NS.HTML],\n    [$.TD, NS.HTML],\n    [$.TEMPLATE, NS.HTML],\n    [$.TH, NS.HTML],\n    [$.ANNOTATION_XML, NS.MATHML],\n    [$.MI, NS.MATHML],\n    [$.MN, NS.MATHML],\n    [$.MO, NS.MATHML],\n    [$.MS, NS.MATHML],\n    [$.MTEXT, NS.MATHML],\n    [$.DESC, NS.SVG],\n    [$.FOREIGN_OBJECT, NS.SVG],\n    [$.TITLE, NS.SVG],\n]);\nconst NAMED_HEADERS = [$.H1, $.H2, $.H3, $.H4, $.H5, $.H6];\nconst TABLE_ROW_CONTEXT = [$.TR, $.TEMPLATE, $.HTML];\nconst TABLE_BODY_CONTEXT = [$.TBODY, $.TFOOT, $.THEAD, $.TEMPLATE, $.HTML];\nconst TABLE_CONTEXT = [$.TABLE, $.TEMPLATE, $.HTML];\nconst TABLE_CELLS = [$.TD, $.TH];\n//Stack of open elements\nexport class OpenElementStack {\n    get currentTmplContentOrNode() {\n        return this._isInTemplate() ? this.treeAdapter.getTemplateContent(this.current) : this.current;\n    }\n    constructor(document, treeAdapter, handler) {\n        this.treeAdapter = treeAdapter;\n        this.handler = handler;\n        this.items = [];\n        this.tagIDs = [];\n        this.stackTop = -1;\n        this.tmplCount = 0;\n        this.currentTagId = $.UNKNOWN;\n        this.current = document;\n    }\n    //Index of element\n    _indexOf(element) {\n        return this.items.lastIndexOf(element, this.stackTop);\n    }\n    //Update current element\n    _isInTemplate() {\n        return this.currentTagId === $.TEMPLATE && this.treeAdapter.getNamespaceURI(this.current) === NS.HTML;\n    }\n    _updateCurrentElement() {\n        this.current = this.items[this.stackTop];\n        this.currentTagId = this.tagIDs[this.stackTop];\n    }\n    //Mutations\n    push(element, tagID) {\n        this.stackTop++;\n        this.items[this.stackTop] = element;\n        this.current = element;\n        this.tagIDs[this.stackTop] = tagID;\n        this.currentTagId = tagID;\n        if (this._isInTemplate()) {\n            this.tmplCount++;\n        }\n        this.handler.onItemPush(element, tagID, true);\n    }\n    pop() {\n        const popped = this.current;\n        if (this.tmplCount > 0 && this._isInTemplate()) {\n            this.tmplCount--;\n        }\n        this.stackTop--;\n        this._updateCurrentElement();\n        this.handler.onItemPop(popped, true);\n    }\n    replace(oldElement, newElement) {\n        const idx = this._indexOf(oldElement);\n        this.items[idx] = newElement;\n        if (idx === this.stackTop) {\n            this.current = newElement;\n        }\n    }\n    insertAfter(referenceElement, newElement, newElementID) {\n        const insertionIdx = this._indexOf(referenceElement) + 1;\n        this.items.splice(insertionIdx, 0, newElement);\n        this.tagIDs.splice(insertionIdx, 0, newElementID);\n        this.stackTop++;\n        if (insertionIdx === this.stackTop) {\n            this._updateCurrentElement();\n        }\n        this.handler.onItemPush(this.current, this.currentTagId, insertionIdx === this.stackTop);\n    }\n    popUntilTagNamePopped(tagName) {\n        let targetIdx = this.stackTop + 1;\n        do {\n            targetIdx = this.tagIDs.lastIndexOf(tagName, targetIdx - 1);\n        } while (targetIdx > 0 && this.treeAdapter.getNamespaceURI(this.items[targetIdx]) !== NS.HTML);\n        this.shortenToLength(targetIdx < 0 ? 0 : targetIdx);\n    }\n    shortenToLength(idx) {\n        while (this.stackTop >= idx) {\n            const popped = this.current;\n            if (this.tmplCount > 0 && this._isInTemplate()) {\n                this.tmplCount -= 1;\n            }\n            this.stackTop--;\n            this._updateCurrentElement();\n            this.handler.onItemPop(popped, this.stackTop < idx);\n        }\n    }\n    popUntilElementPopped(element) {\n        const idx = this._indexOf(element);\n        this.shortenToLength(idx < 0 ? 0 : idx);\n    }\n    popUntilPopped(tagNames, targetNS) {\n        const idx = this._indexOfTagNames(tagNames, targetNS);\n        this.shortenToLength(idx < 0 ? 0 : idx);\n    }\n    popUntilNumberedHeaderPopped() {\n        this.popUntilPopped(NAMED_HEADERS, NS.HTML);\n    }\n    popUntilTableCellPopped() {\n        this.popUntilPopped(TABLE_CELLS, NS.HTML);\n    }\n    popAllUpToHtmlElement() {\n        //NOTE: here we assume that the root <html> element is always first in the open element stack, so\n        //we perform this fast stack clean up.\n        this.tmplCount = 0;\n        this.shortenToLength(1);\n    }\n    _indexOfTagNames(tagNames, namespace) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            if (tagNames.includes(this.tagIDs[i]) && this.treeAdapter.getNamespaceURI(this.items[i]) === namespace) {\n                return i;\n            }\n        }\n        return -1;\n    }\n    clearBackTo(tagNames, targetNS) {\n        const idx = this._indexOfTagNames(tagNames, targetNS);\n        this.shortenToLength(idx + 1);\n    }\n    clearBackToTableContext() {\n        this.clearBackTo(TABLE_CONTEXT, NS.HTML);\n    }\n    clearBackToTableBodyContext() {\n        this.clearBackTo(TABLE_BODY_CONTEXT, NS.HTML);\n    }\n    clearBackToTableRowContext() {\n        this.clearBackTo(TABLE_ROW_CONTEXT, NS.HTML);\n    }\n    remove(element) {\n        const idx = this._indexOf(element);\n        if (idx >= 0) {\n            if (idx === this.stackTop) {\n                this.pop();\n            }\n            else {\n                this.items.splice(idx, 1);\n                this.tagIDs.splice(idx, 1);\n                this.stackTop--;\n                this._updateCurrentElement();\n                this.handler.onItemPop(element, false);\n            }\n        }\n    }\n    //Search\n    tryPeekProperlyNestedBodyElement() {\n        //Properly nested <body> element (should be second element in stack).\n        return this.stackTop >= 1 && this.tagIDs[1] === $.BODY ? this.items[1] : null;\n    }\n    contains(element) {\n        return this._indexOf(element) > -1;\n    }\n    getCommonAncestor(element) {\n        const elementIdx = this._indexOf(element) - 1;\n        return elementIdx >= 0 ? this.items[elementIdx] : null;\n    }\n    isRootHtmlElementCurrent() {\n        return this.stackTop === 0 && this.tagIDs[0] === $.HTML;\n    }\n    //Element in scope\n    hasInScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n            if (tn === tagName && ns === NS.HTML) {\n                return true;\n            }\n            if (SCOPING_ELEMENT_NS.get(tn) === ns) {\n                return false;\n            }\n        }\n        return true;\n    }\n    hasNumberedHeaderInScope() {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n            if (isNumberedHeader(tn) && ns === NS.HTML) {\n                return true;\n            }\n            if (SCOPING_ELEMENT_NS.get(tn) === ns) {\n                return false;\n            }\n        }\n        return true;\n    }\n    hasInListItemScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n            if (tn === tagName && ns === NS.HTML) {\n                return true;\n            }\n            if (((tn === $.UL || tn === $.OL) && ns === NS.HTML) || SCOPING_ELEMENT_NS.get(tn) === ns) {\n                return false;\n            }\n        }\n        return true;\n    }\n    hasInButtonScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n            if (tn === tagName && ns === NS.HTML) {\n                return true;\n            }\n            if ((tn === $.BUTTON && ns === NS.HTML) || SCOPING_ELEMENT_NS.get(tn) === ns) {\n                return false;\n            }\n        }\n        return true;\n    }\n    hasInTableScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n            if (ns !== NS.HTML) {\n                continue;\n            }\n            if (tn === tagName) {\n                return true;\n            }\n            if (tn === $.TABLE || tn === $.TEMPLATE || tn === $.HTML) {\n                return false;\n            }\n        }\n        return true;\n    }\n    hasTableBodyContextInTableScope() {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n            if (ns !== NS.HTML) {\n                continue;\n            }\n            if (tn === $.TBODY || tn === $.THEAD || tn === $.TFOOT) {\n                return true;\n            }\n            if (tn === $.TABLE || tn === $.HTML) {\n                return false;\n            }\n        }\n        return true;\n    }\n    hasInSelectScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.tagIDs[i];\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n            if (ns !== NS.HTML) {\n                continue;\n            }\n            if (tn === tagName) {\n                return true;\n            }\n            if (tn !== $.OPTION && tn !== $.OPTGROUP) {\n                return false;\n            }\n        }\n        return true;\n    }\n    //Implied end tags\n    generateImpliedEndTags() {\n        while (IMPLICIT_END_TAG_REQUIRED.has(this.currentTagId)) {\n            this.pop();\n        }\n    }\n    generateImpliedEndTagsThoroughly() {\n        while (IMPLICIT_END_TAG_REQUIRED_THOROUGHLY.has(this.currentTagId)) {\n            this.pop();\n        }\n    }\n    generateImpliedEndTagsWithExclusion(exclusionId) {\n        while (this.currentTagId !== exclusionId && IMPLICIT_END_TAG_REQUIRED_THOROUGHLY.has(this.currentTagId)) {\n            this.pop();\n        }\n    }\n}\n//# sourceMappingURL=open-element-stack.js.map"]},"metadata":{},"sourceType":"module"}